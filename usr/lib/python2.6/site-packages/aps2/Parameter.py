import simplejson as json
import ordereddict
import urllib2

import aps2.uLogging

logger = aps2.uLogging.get_logger('/tmp/myapp.log', aps2.uLogging.DEBUG)

STRING = "string"
INTEGER = "integer"
BOOLEAN = "boolean"
NUMBER = "number"


def str2bool(v):
    return v.lower() in ("yes", "true", "t", "1")


def convert_to_type(value, type_param):
    if type_param == STRING:
        return urllib2.unquote(value)
    elif type_param == INTEGER:
        return int(value)
    elif type_param == BOOLEAN:
        return str2bool(value)
    elif type_param == NUMBER:
        return float(value)
    else:
        logger.info("It's not simple type! ")
        # TODO return structure from 'type'
        return ":)"


class Parameter:
    def __init__(self, name_parameter, value, json):
        self.name = name_parameter
        self.json = json
        self.value = convert_to_type(value, json["type"])

    def to_string(self):
        return "name = " + self.name + "\n" \
               + "value = " + str(self.value) + " ===" + str(type(self.value)) + "\n" \
               + "json = \n" + json.dumps(self.json, indent=8) + "\n"

    def to_string_without_json(self):
        return "name = " + self.name + "\n" \
               + "value = " + str(self.value) + " ===" + str(type(self.value)) + "\n"


